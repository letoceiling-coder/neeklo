import{j as e}from"./motion-vendor-BDjNjK_3.js";import{g as Q,r as i,L as K}from"./react-vendor-BPADj-9C.js";import{f as W,h as X,i as P,j as _,k as $}from"./index-BGdf3VGM.js";import{F as j,Z as ee,K as se,as as ae,l as te,at as R,au as V,ar as ie}from"./ui-vendor-DApkxKmO.js";import"./products-D4wmSXpS.js";import"./query-vendor-CDDlTtdy.js";function me(){const{id:b}=Q(),[r,f]=i.useState(null),[Y,Z]=i.useState(!0),[m,n]=i.useState(null),[v,N]=i.useState(!1),[h,x]=i.useState(null),[y,C]=i.useState(""),[k,S]=i.useState(""),[E,L]=i.useState(""),[g,M]=i.useState(""),[U,D]=i.useState(!1),[F,I]=i.useState(""),[A,c]=i.useState([]);i.useEffect(()=>{b&&W(Number(b)).then(s=>{if(Z(!1),s.success&&s.data){const a=s.data;f(a),C(a.slug||""),S(a.title||""),L(a.category||""),M(a.year??""),D(!!a.featured),I(a.description||""),c(a.media||[])}else n(s.message||"Ошибка")})},[b]);const q=async()=>{if(!r)return;N(!0);const s=await X(r.id,{slug:y,title:k,category:E||void 0,year:g===""?void 0:Number(g),featured:U,description:F||void 0});N(!1),s.success&&s.data?f(s.data):n(s.message||"Ошибка сохранения")},o=A.filter(s=>s.type==="image").sort((s,a)=>s.order-a.order),p=A.filter(s=>s.type==="video")[0],G=async s=>{const a=s.target.files?.[0];if(!a||!r)return;s.target.value="",x("image");const t=await P(r.id,a,"image");x(null),t.success&&t.data?c(l=>[...l,t.data]):n(t.message||"Ошибка загрузки")},H=async s=>{const a=s.target.files?.[0];if(!a||!r)return;s.target.value="",x("video");const t=await P(r.id,a,"video");x(null),t.success&&t.data?c(l=>[...l,t.data]):n(t.message||"Ошибка загрузки")},B=async s=>{const a=await _(s.id);a.success?c(t=>t.filter(l=>l.id!==s.id)):n(a.message||"Ошибка удаления")},T=async(s,a,t)=>{const l=a+t;if(l<0||l>=s.length)return;const d=[...s];[d[a],d[l]]=[d[l],d[a]];const J=d.map(w=>w.id),z=await $(r.id,J);z.success?c(w=>w.map(u=>u.type==="image"&&d.find(O=>O.id===u.id)||u)):n(z.message||"Ошибка сортировки")};return Y?e.jsx("div",{className:"min-h-screen bg-[#0a0a0a] flex items-center justify-center",children:e.jsx(j,{className:"w-8 h-8 animate-spin text-cyan-400"})}):m&&!r?e.jsxs("div",{className:"min-h-screen bg-[#0a0a0a] text-white p-8",children:[e.jsx("p",{className:"text-red-400",children:m}),e.jsx(K,{to:"/admin/cases",className:"text-cyan-400 mt-4 inline-block",children:"← К списку"})]}):r?e.jsx("div",{className:"min-h-screen bg-[#0a0a0a] text-white p-6 md:p-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs(K,{to:"/admin/cases",className:"inline-flex items-center gap-2 text-white/70 hover:text-white mb-6",children:[e.jsx(ee,{className:"w-4 h-4"})," К списку"]}),m&&e.jsx("p",{className:"text-red-400 mb-4",children:m}),e.jsxs("section",{className:"mb-8 p-6 rounded-2xl bg-white/5 border border-white/10",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Основное"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-white/60 block mb-1",children:"slug"}),e.jsx("input",{value:y,onChange:s=>C(s.target.value),className:"w-full px-4 py-2 rounded-xl bg-white/5 border border-white/10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-white/60 block mb-1",children:"Название"}),e.jsx("input",{value:k,onChange:s=>S(s.target.value),className:"w-full px-4 py-2 rounded-xl bg-white/5 border border-white/10"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-white/60 block mb-1",children:"Категория"}),e.jsx("input",{value:E,onChange:s=>L(s.target.value),className:"w-full px-4 py-2 rounded-xl bg-white/5 border border-white/10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-white/60 block mb-1",children:"Год"}),e.jsx("input",{type:"number",value:g,onChange:s=>M(s.target.value===""?"":Number(s.target.value)),className:"w-full px-4 py-2 rounded-xl bg-white/5 border border-white/10"})]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:U,onChange:s=>D(s.target.checked)}),e.jsx("span",{children:"В избранном"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-white/60 block mb-1",children:"Описание"}),e.jsx("textarea",{value:F,onChange:s=>I(s.target.value),rows:3,className:"w-full px-4 py-2 rounded-xl bg-white/5 border border-white/10 resize-none"})]}),e.jsx("button",{onClick:q,disabled:v,className:"px-6 py-2 rounded-xl bg-cyan-500 text-black font-medium disabled:opacity-50",children:v?"Сохранение…":"Сохранить"})]})]}),e.jsxs("section",{className:"p-6 rounded-2xl bg-white/5 border border-white/10 shadow-2xl shadow-black/50",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Медиа"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(se,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-sm font-medium",children:"Изображения (до 5)"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[o.map((s,a)=>e.jsxs("div",{className:"relative group w-24 h-24 rounded-xl overflow-hidden bg-white/5 border border-white/10",children:[e.jsx("img",{src:s.url,alt:"",className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-1 transition-opacity",children:[e.jsx("button",{onClick:()=>T(o,a,-1),disabled:a===0,className:"p-1.5 rounded-lg bg-white/20 hover:bg-white/30 disabled:opacity-30",title:"Выше",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>T(o,a,1),disabled:a===o.length-1,className:"p-1.5 rounded-lg bg-white/20 hover:bg-white/30 disabled:opacity-30",title:"Ниже",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>B(s),className:"p-1.5 rounded-lg bg-red-500/80 hover:bg-red-500",children:e.jsx(R,{className:"w-4 h-4"})})]})]},s.id)),o.length<5&&e.jsxs("label",{className:"w-24 h-24 rounded-xl border-2 border-dashed border-white/20 flex items-center justify-center cursor-pointer hover:border-cyan-400/50 hover:bg-white/5 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/webp",onChange:G,className:"hidden",disabled:!!h}),h==="image"?e.jsx(j,{className:"w-6 h-6 animate-spin text-white/60"}):e.jsx(V,{className:"w-6 h-6 text-white/50"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ie,{className:"w-4 h-4 text-violet-400"}),e.jsx("span",{className:"text-sm font-medium",children:"Видео (1, mp4/webm, до 50 MB)"})]}),p?e.jsxs("div",{className:"relative group max-w-xs",children:[e.jsx("video",{src:p.url,controls:!0,className:"w-full rounded-xl bg-black/50"}),e.jsx("button",{onClick:()=>B(p),className:"absolute top-2 right-2 p-2 rounded-lg bg-red-500/80 hover:bg-red-500",title:"Удалить",children:e.jsx(R,{className:"w-4 h-4"})})]}):e.jsxs("label",{className:"inline-flex items-center gap-2 px-4 py-3 rounded-xl border-2 border-dashed border-white/20 cursor-pointer hover:border-violet-400/50 hover:bg-white/5 transition-colors",children:[e.jsx("input",{type:"file",accept:"video/mp4,video/webm",onChange:H,className:"hidden",disabled:!!h}),h==="video"?e.jsx(j,{className:"w-5 h-5 animate-spin"}):e.jsx(V,{className:"w-5 h-5 text-white/50"}),e.jsx("span",{className:"text-sm text-white/70",children:"Загрузить видео"})]})]})]})]})}):null}export{me as default};
